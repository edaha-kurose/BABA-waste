# 完全版テストデータ作成ガイド

## 🎯 概要

**全マスターデータ + 単価設定 + 1年分の完全なテストデータ**を自動作成します。

---

## 📦 作成されるデータ

### 【マスターデータ】

| データ種別 | 件数 | 説明 |
|------------|------|------|
| **廃棄物種別マスター** | 20件 | 燃え殻、汚泥、廃油等（単価設定込み） |
| **収集業者マスター** | 5社 | エコ回収、グリーン運送等 |
| **処分場マスター** | 5箇所 | 中央最終処分場、リサイクルセンター等 |
| **店舗マスター** | 10件 | 本店 + 支店A～I |
| **店舗・収集業者割り当て** | 10件 | 店舗ごとに担当収集業者を設定 |
| **品目マップ** | 10件 | 混合廃棄物、廃プラスチック等（単価設定込み） |
| **JWNET事業者組み合わせ** | 5件 | 排出事業者・収集業者・処分場の組み合わせ |

### 【トランザクションデータ（1年分）】

| データ種別 | 件数 | 説明 |
|------------|------|------|
| **収集予定（Plans）** | 240件 | 12ヶ月 × 10店舗 × 2回/月 |
| **予約（Reservations）** | 240件 | 全Plans対応（90%がRESERVED） |
| **登録（Registrations）** | ~220件 | RESERVED Plans対応（95%がREGISTERED） |
| **実績（Actuals）** | ~210件 | REGISTERED Plans対応（実績は計画の90～110%） |
| **請求サマリー** | 12件 | 月次集計（運搬費・処分費・消費税込み） |

---

## 🚀 実行方法

```bash
# 1. ディレクトリ移動
cd next-app

# 2. Prisma生成
pnpm prisma:generate

# 3. 完全版シード実行
pnpm prisma:seed
```

**たったこれだけ！** 全マスター + 1年分のテストデータが完成します。

---

## 💰 単価設定の詳細

### 廃棄物種別マスター単価例

| 廃棄物種別 | 単価（円/トン） | 有害性 |
|------------|----------------|--------|
| 燃え殻 | 15,000 | なし |
| 汚泥 | 18,000 | なし |
| 廃油 | 25,000 | **あり** |
| 廃酸 | 30,000 | **あり** |
| 廃アルカリ | 30,000 | **あり** |
| 廃プラスチック類 | 20,000 | なし |
| 紙くず | 12,000 | なし |
| 木くず | 10,000 | なし |
| 金属くず | 8,000 | なし |
| 混合廃棄物 | 18,000 | なし |

### 品目マップ単価例

| 品目名 | 処分費（円） | 運搬費（円） | 単位 |
|--------|-------------|-------------|------|
| 混合廃棄物 | 18,000 | 10,000 | トン |
| 廃プラスチック類 | 20,000 | 12,000 | トン |
| 蛍光灯（水銀含有） | 250 | 150 | kg |
| 木くず | 10,000 | 8,000 | m³ |
| 金属くず | 8,000 | 6,000 | トン |
| 廃油 | 25,000 | 15,000 | トン |
| がれき類 | 8,000 | 5,000 | トン |

---

## 📊 請求計算例

### 月次請求計算ロジック

```
運搬費 = 実績数量 × 運搬単価
処分費 = 実績数量 × 処分単価
小計 = 運搬費 + 処分費
消費税 = 小計 × 10%
合計金額 = 小計 + 消費税
```

### 例: 2024年1月

| 項目 | 金額 |
|------|------|
| 総数量 | 42.35トン |
| 運搬費 | 423,500円 |
| 処分費 | 635,250円 |
| 小計 | 1,058,750円 |
| 消費税（10%） | 105,875円 |
| **合計金額** | **1,164,625円** |

---

## 🏢 収集業者の詳細

### 作成される収集業者

1. **エコ回収株式会社**
   - 営業エリア: 東京、神奈川
   - 許可番号: 東京都-産廃-001

2. **グリーン運送**
   - 営業エリア: 大阪、京都
   - 許可番号: 大阪府-産廃-002

3. **クリーンジャパン**
   - 営業エリア: 名古屋、岐阜
   - 許可番号: 愛知県-産廃-003

4. **エコロジー物流**
   - 営業エリア: 福岡、佐賀
   - 許可番号: 福岡県-産廃-004

5. **リサイクルサービス**
   - 営業エリア: 札幌、旭川
   - 許可番号: 北海道-産廃-005

---

## 🏭 処分場の詳細

### 作成される処分場

1. **中央最終処分場** - 東京
2. **西部リサイクルセンター** - 大阪
3. **東海クリーンセンター** - 名古屋
4. **九州エコセンター** - 福岡
5. **北海道処理施設** - 札幌

各処分場には以下の情報が設定されます：
- 許可番号
- 処理能力（10,000トン）
- 利用可能容量（8,000トン）
- 住所・電話番号

---

## 🔗 店舗・収集業者割り当て

| 店舗 | エリア | 担当収集業者 |
|------|--------|-------------|
| 本店 | 東京 | エコ回収株式会社 |
| 支店A | 東京 | エコ回収株式会社 |
| 支店B | 東京 | エコ回収株式会社 |
| 支店C | 大阪 | グリーン運送 |
| 支店D | 大阪 | グリーン運送 |
| 支店E | 名古屋 | クリーンジャパン |
| 支店F | 福岡 | エコロジー物流 |
| 支店G | 札幌 | リサイクルサービス |
| 支店H | 仙台 | エコ回収株式会社 |
| 支店I | 広島 | グリーン運送 |

---

## 🔐 JWNET事業者組み合わせ

排出事業者・収集業者・処分場の組み合わせを5パターン作成：

| 排出事業者 | 収集業者 | 処分場 | 加入者番号 |
|-----------|---------|--------|-----------|
| テスト組織 | エコ回収 | 中央最終処分場 | EMT-1000 / COL-2000 / DSP-3000 |
| テスト組織 | グリーン運送 | 西部RC | EMT-1001 / COL-2001 / DSP-3001 |
| テスト組織 | クリーンジャパン | 東海CC | EMT-1002 / COL-2002 / DSP-3002 |
| テスト組織 | エコロジー物流 | 九州EC | EMT-1003 / COL-2003 / DSP-3003 |
| テスト組織 | リサイクルS | 北海道施設 | EMT-1004 / COL-2004 / DSP-3004 |

---

## ✨ 特徴

### 1. 完全自動化
- マスターデータから請求まで一括作成
- 単価設定も自動反映
- 組み合わせパターンも自動生成

### 2. リアルなデータ
- 実際の廃棄物種別名称
- 現実的な単価設定
- 地域ごとの収集業者配置

### 3. 安全性
- 型安全（TypeScript）
- トランザクション管理
- 論理削除で復元可能
- 何度でも再実行可能

### 4. 検証機能
- データ件数の自動チェック
- 異常時は例外をスロー
- 月次集計の整合性確認

---

## 🔄 再実行について

**完全に安全に再実行可能！**

```bash
# 何度でも実行OK
pnpm prisma:seed
```

既存のテストデータは自動的にクリーンアップ（論理削除）され、新しいデータが作成されます。

---

## 📈 実行ログ例

```
============================================================
🌱 完全版シード開始
============================================================

============================================================
🗑️  既存テストデータをクリーンアップ
============================================================
✅ クリーンアップ完了

============================================================
📋 廃棄物種別マスター作成
============================================================
✅ 廃棄物種別マスター作成完了: 20件

============================================================
🚚 収集業者マスター作成
============================================================
✅ 収集業者マスター作成完了: 5社

============================================================
🏭 処分場マスター作成
============================================================
✅ 処分場マスター作成完了: 5箇所

============================================================
🏪 店舗データ作成
============================================================
✅ 店舗データ作成完了: 10件

============================================================
🔗 店舗・収集業者割り当て作成
============================================================
✅ 店舗・収集業者割り当て作成完了: 10件

============================================================
📦 品目マップデータ作成
============================================================
✅ 品目マップデータ作成完了: 10件

============================================================
🔐 JWNET事業者組み合わせ作成
============================================================
✅ JWNET事業者組み合わせ作成完了: 5件

============================================================
📅 収集予定データ作成（1年分）
============================================================
ℹ️  1月のデータ作成中...
ℹ️  2月のデータ作成中...
...
✅ 収集予定データ作成完了: 240件
✅ 予約データ作成完了: 240件
✅ 登録データ作成完了: 216件
✅ 実績データ作成完了: 205件

============================================================
💰 請求サマリーデータ作成
============================================================
ℹ️  1月: 42.35トン, 1,164,625円
ℹ️  2月: 38.21トン, 1,050,305円
...
✅ 請求サマリーデータ作成完了: 12件

============================================================
📊 最終検証
============================================================

============================================================
🎉 完全版テストデータ作成完了！
============================================================

【マスターデータ】
  - 廃棄物種別マスター: 20件
  - 収集業者マスター: 5社
  - 処分場マスター: 5箇所
  - 店舗マスター: 10件
  - 店舗・収集業者割り当て: 10件
  - 品目マップ: 10件
  - JWNET事業者組み合わせ: 5件

【トランザクションデータ】
  - 収集予定: 240件
  - 予約: 240件
  - 登録: 216件
  - 実績: 205件
  - 請求サマリー: 12件

✅ 📊 2024年1月～12月の完全なテストデータが利用可能です！
```

---

## 💡 次のステップ

### 1. シード実行
```bash
cd next-app
pnpm prisma:generate
pnpm prisma:seed
```

### 2. データ確認
```bash
# Prisma Studioで確認
pnpm prisma:studio
```

### 3. アプリケーション起動
```bash
pnpm dev
```

### 4. ブラウザで確認
```
http://localhost:3001/dashboard
```

---

## 🎯 動作確認ポイント

### マスターデータ確認
1. 廃棄物種別マスター画面で20件表示
2. 収集業者マスター画面で5社表示
3. 処分場マスター画面で5箇所表示
4. 店舗・収集業者割り当てで10件表示

### トランザクションデータ確認
1. 収集予定一覧で240件表示
2. 各月ごとに約20件のPlan表示
3. JWNET予約・登録データ表示
4. 実績データ表示

### 請求データ確認
1. 請求サマリーで12ヶ月分表示
2. 各月の金額が計算されている
3. 運搬費・処分費・消費税が正しく表示

---

**作成日**: 2025-10-16  
**更新日**: 2025-10-16  
**バージョン**: 2.0（完全版）







