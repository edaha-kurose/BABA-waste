# テストデータ完全ガイド

**最終更新**: 2025-10-20

---

## 📊 現在のテストデータ状況

| データ種別 | 件数 | 状態 |
|------------|------|------|
| **組織** | 8件 | ✅ |
| **店舗** | 1,649件 | ✅ |
| **収集業者** | 201件 | ✅ |
| **品目マップ** | 20件 | ✅ |
| **廃棄物種別マスター** | 25件 | ✅ |
| **契約** | 1件 | ✅ |
| **収集予定** | 1,255件 | ✅ |
| **予約** | 1,252件 | ✅ |
| **登録** | 1,105件 | ✅ |
| **実績** | 1,105件 | ✅ |
| **請求サマリー** | 12件 | ✅ |
| **請求明細** | 18件 | ✅ |

---

## 🚀 クイックスタート

### 初回セットアップ（全データ作成）

```bash
cd next-app

# Step 1: 基本データ（店舗、収集業者、収集予定、実績等）
pnpm prisma:seed

# Step 2: マスターデータ（廃棄物種別マスター、契約、初期請求明細）
pnpm prisma:seed:complete

# Step 3: 請求パターン網羅データ（月額固定、実績数量、その他）
pnpm prisma:seed:billing
```

### データ確認

```bash
# 基本確認
node scripts/check-test-data.mjs

# 請求パターン詳細確認
node scripts/check-billing-patterns.mjs
```

---

## 📋 各Seedスクリプトの役割

### 1. `pnpm prisma:seed` - 基本データ

**ファイル**: `prisma/seed-final.ts`

**作成内容**:
- 収集業者: 1社（エコ回収株式会社）
- 店舗: 10件（本店 + 支店A～I）
- 品目マップ: 10件（混合廃棄物、廃プラスチック等）
- 収集予定: 240件（2024年1月～12月、月2回×10店舗）
- 予約: 240件（90%が予約済み）
- 登録: ~220件（95%が登録済み）
- 実績: ~210件
- 請求サマリー: 12件（月次集計）

**実行タイミング**: 最初に実行（他のseedの前提条件）

---

### 2. `pnpm prisma:seed:complete` - マスターデータ

**ファイル**: `prisma/seed-complete.ts`

**作成内容**:
- 廃棄物種別マスター: 20件（単価設定込み）
  - 燃え殻、汚泥、廃油、廃酸、廃アルカリ
  - 廃プラスチック、紙くず、木くず、繊維くず
  - 動植物性残さ、ゴムくず、金属くず
  - ガラス、鉱さい、がれき類、ばいじん
  - 蛍光灯、電池、混合廃棄物、一般廃棄物
- 契約: 1件（デモ組織の基本契約）
- 請求明細: 2件（実績ベースの初期データ）

**実行タイミング**: `pnpm prisma:seed` の後

---

### 3. `pnpm prisma:seed:billing` - 請求パターン網羅データ

**ファイル**: `prisma/seed-billing-patterns.ts`

**作成内容**:
- **月額固定**: 4件
  - 廃棄物管理サービス月額利用料
  - 定額サービス（数量・単価なし）
- **実績数量ベース**: 6件
  - 廃棄物種別ごとの従量課金
  - 数量×単価の計算
- **その他（特別料金）**: 6件
  - 緊急回収サービス
  - マニフェスト電子化手数料
  - 特別管理産業廃棄物処理加算
  - 前月過不足調整（マイナス金額）
  - 運搬距離追加料金
  - 容器レンタル料
- **複合パターン**: 3件（1店舗に複数明細）

**実行タイミング**: `pnpm prisma:seed:complete` の後

---

## 🧪 テストシナリオ

### 基本機能テスト

#### 1. 収集予定管理
- [ ] 月次予定一覧表示
- [ ] 店舗別フィルタ
- [ ] 予約→登録→実績のステータス遷移

#### 2. 請求書管理
- [ ] 請求書一覧表示（全てのタイプが表示される）
- [ ] 請求タイプ別フィルタ（月額固定、実績数量、その他）
- [ ] ステータス別フィルタ（DRAFT、APPROVED）
- [ ] 店舗別集計
- [ ] 月次集計

#### 3. 請求明細編集
- [ ] 実績数量の変更で金額が自動計算される
- [ ] マイナス金額（返金）の入力
- [ ] DRAFT→APPROVED への承認フロー

#### 4. マスターデータ管理
- [ ] 廃棄物種別マスター一覧（25件表示）
- [ ] 単価変更履歴
- [ ] 契約管理

---

## 📦 データの特徴

### 組織・ユーザー
- **デモ組織ID**: `12345678-1234-1234-1234-123456789012`
- **管理者ユーザー**: `admin@test.com`
- **収集業者ユーザー**: `collector@test.com`
- **排出事業者ユーザー**: `emitter@test.com`

### 期間
- **収集予定**: 2024年1月～12月（1年分）
- **請求月**: 2024年10月（パターン網羅データ）
- **請求サマリー**: 2024年1月～12月（12ヶ月分）

### 金額範囲
- **月額固定**: 40,000円～50,000円
- **実績数量**: 数十円～数万円（数量・単価による）
- **その他**: -8,000円～30,000円（マイナス金額含む）

---

## 🔄 データ再生成

### 全データリセット＋再生成

```bash
# 注意: 既存のテストデータは削除されます
cd next-app

# Step 1: 基本データ削除＋再作成
pnpm prisma:seed

# Step 2: マスターデータ追加
pnpm prisma:seed:complete

# Step 3: 請求パターン追加
pnpm prisma:seed:billing

# Step 4: 確認
node scripts/check-test-data.mjs
node scripts/check-billing-patterns.mjs
```

### 部分的な追加

```bash
# 請求パターンのみ追加（既存データは保持）
pnpm prisma:seed:billing
```

---

## 📖 詳細ドキュメント

- **請求パターン詳細**: `docs/TEST_DATA_BILLING_PATTERNS.md`
- **Prismaシード戦略**: `README_SEED.md`
- **完全版シード**: `README_SEED_COMPLETE.md`

---

## ⚠️ 注意事項

### データ量について
- 現在のテストデータは開発・テスト用途に最適化
- 本番環境では使用しないこと
- パフォーマンステストには追加データ生成が必要

### 外部キー制約
- 全てのテーブルで外部キー制約が有効
- 削除時はカスケード設定に注意
- トランザクション処理を使用

### 論理削除
- `deleted_at` カラムで論理削除を実装
- Seedスクリプトは既存データを論理削除してから再作成

---

**このドキュメントに関する質問や改善提案は、開発チームまでお願いします。**



