#!/usr/bin/env sh
echo "ğŸ” Pre-commit ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œä¸­..."

# å‹ãƒã‚§ãƒƒã‚¯ & Lintï¼ˆå­˜åœ¨ã™ã‚Œã°ï¼‰
[ -f package.json ] && { pnpm typecheck || true; pnpm lint || true; }

# DDLå¤‰æ›´æ¤œçŸ¥ â†’ ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
CHANGED_FILES=$(git diff --cached --name-only)
if echo "$CHANGED_FILES" | grep -qE "\b(db/ddl/|prisma/migrations/)"; then
  echo "âš ï¸ DDL/ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®å¤‰æ›´ã‚’æ¤œå‡ºã€‚"
  echo "ğŸ“‹ ãƒã‚§ãƒƒã‚¯:"
  echo "  [ ] å½±éŸ¿ç¯„å›²: pnpm schema:impact -- --table <t> [--column <c>]"
  echo "  [ ] å‹å†ç”Ÿæˆ: pnpm gen:db-types && pnpm codegen"
  echo "  [ ] ãƒ†ã‚¹ãƒˆ: pnpm test || true"
  printf "ç¶šè¡Œã—ã¾ã™ã‹ï¼Ÿ (y/N) "
  read ANS
  if [ "$ANS" != "y" ] && [ "$ANS" != "Y" ]; then
    echo "ä¸­æ–­ã—ã¾ã—ãŸã€‚"
    exit 1
  fi
fi

echo "âœ… OK"
