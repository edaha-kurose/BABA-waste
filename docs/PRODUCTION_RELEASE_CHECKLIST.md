# 本番リリース最終チェックリスト 🚀

**プロジェクト**: BABA Waste Management System  
**リリース予定日**: _______________  
**担当者**: _______________  
**最終更新日**: 2025-10-13

---

## 📋 チェックリストの使い方

1. 各項目を順番に実施
2. 完了したら `[ ]` → `[x]` に変更
3. 問題が発生した場合は「備考」欄に記入
4. 全項目完了後、承認者の署名を取得

---

## Phase 1: 本番環境セットアップ ✅

### 1.1 Supabase 本番プロジェクト作成

- [ ] **1.1.1** Supabase アカウントにログイン
- [ ] **1.1.2** 新規プロジェクト作成（Project Name: BABA-Waste-Production）
- [ ] **1.1.3** リージョン選択（推奨: ap-northeast-1 / Tokyo）
- [ ] **1.1.4** Database Password を安全に保管
- [ ] **1.1.5** プロジェクトが Active 状態であることを確認

**備考**: ________________________________________________

---

### 1.2 データベース接続情報の取得

- [ ] **1.2.1** Settings → Database に移動
- [ ] **1.2.2** Connection string セクションを確認
- [ ] **1.2.3** **Session Pooler** の接続文字列を取得（マイグレーション用）
- [ ] **1.2.4** **Transaction Pooler** の接続文字列を取得（アプリケーション用）
- [ ] **1.2.5** 接続文字列を安全に保管（パスワードマネージャー推奨）

**Session Pooler URL（DIRECT_URL用）**:
```
postgresql://postgres.[PROJECT_REF]:[PASSWORD]@aws-X-XX-XXXX-X.pooler.supabase.com:5432/postgres?sslmode=require
```

**Transaction Pooler URL（DATABASE_URL用）**:
```
postgresql://postgres.[PROJECT_REF]:[PASSWORD]@aws-X-XX-XXXX-X.pooler.supabase.com:6543/postgres?pgbouncer=true&sslmode=require
```

**備考**: ________________________________________________

---

### 1.3 Supabase API キーの取得

- [ ] **1.3.1** Settings → API に移動
- [ ] **1.3.2** Project URL を取得
- [ ] **1.3.3** `anon` `public` キーを取得
- [ ] **1.3.4** `service_role` `secret` キーを取得
- [ ] **1.3.5** API キーを安全に保管

**Project URL**:
```
https://[PROJECT_REF].supabase.co
```

**備考**: ________________________________________________

---

### 1.4 データベースマイグレーション

- [ ] **1.4.1** ローカルで `.env.local` に本番DB接続情報を設定
- [ ] **1.4.2** マイグレーションファイルを確認
  ```bash
  cd next-app
  ls prisma/migrations/
  ```
- [ ] **1.4.3** マイグレーションを実行
  ```bash
  pnpm dotenv -e .env.local -- prisma migrate deploy
  ```
- [ ] **1.4.4** マイグレーション成功を確認（エラーがないこと）
- [ ] **1.4.5** Prisma Client を生成
  ```bash
  pnpm prisma generate
  ```

**備考**: ________________________________________________

---

### 1.5 Seedデータの投入（オプション）

- [ ] **1.5.1** Supabase SQL Editor を開く
- [ ] **1.5.2** `db/seed/001_organizations.sql` を実行
- [ ] **1.5.3** `db/seed/002_users.sql` を実行
- [ ] **1.5.4** `db/seed/003_stores.sql` を実行
- [ ] **1.5.5** `db/seed/004_item_maps.sql` を実行
- [ ] **1.5.6** `db/seed/005_jwnet_waste_codes.sql` を実行
- [ ] **1.5.7** `db/seed/006_waste_type_masters.sql` を実行
- [ ] **1.5.8** `db/seed/007_jwnet_party_combinations.sql` を実行
- [ ] **1.5.9** 各テーブルにデータが投入されたことを確認

**備考**: ________________________________________________

---

## Phase 2: Vercel デプロイメント ✅

### 2.1 GitHub リポジトリの準備

- [ ] **2.1.1** GitHub に main ブランチをプッシュ済み
- [ ] **2.1.2** 最新のコードが main ブランチにマージ済み
- [ ] **2.1.3** `.gitignore` に `.env.local` が含まれていることを確認
- [ ] **2.1.4** README.md が最新であることを確認

**備考**: ________________________________________________

---

### 2.2 Vercel プロジェクト作成

- [ ] **2.2.1** Vercel ダッシュボードにログイン
- [ ] **2.2.2** 「Add New Project」をクリック
- [ ] **2.2.3** GitHub リポジトリを選択（BABA-waste）
- [ ] **2.2.4** プロジェクト設定を確認：
  - Framework Preset: `Next.js`
  - Root Directory: `next-app`
  - Build Command: `pnpm run build`
  - Output Directory: `.next`
  - Install Command: `pnpm install`
- [ ] **2.2.5** 「Deploy」ボタンをクリック（初回は失敗する可能性あり）

**備考**: ________________________________________________

---

### 2.3 環境変数の設定

- [ ] **2.3.1** Vercel プロジェクト → Settings → Environment Variables に移動
- [ ] **2.3.2** 以下の環境変数を追加（Production 環境）：

#### Database 設定
- [ ] `DATABASE_URL` (Transaction Pooler URL)
- [ ] `DIRECT_URL` (Session Pooler URL)

#### Supabase 設定
- [ ] `NEXT_PUBLIC_SUPABASE_URL` (Project URL)
- [ ] `NEXT_PUBLIC_SUPABASE_ANON_KEY` (anon public key)
- [ ] `SUPABASE_SERVICE_ROLE_KEY` (service_role secret key)

#### Application 設定
- [ ] `NEXT_PUBLIC_APP_URL` (https://your-domain.vercel.app)
- [ ] `NODE_ENV` (production)

#### JWNET API 設定（本番APIキーが必要）
- [ ] `JWNET_API_URL`
- [ ] `JWNET_API_KEY`
- [ ] `JWNET_SUBSCRIBER_NO`
- [ ] `JWNET_PUBLIC_CONFIRM_NO`

**備考**: ________________________________________________

---

### 2.4 再デプロイと動作確認

- [ ] **2.4.1** Deployments → 最新デプロイ → 「Redeploy」
- [ ] **2.4.2** デプロイ成功を確認（ビルドエラーがないこと）
- [ ] **2.4.3** Production URL にアクセス
- [ ] **2.4.4** トップページが正常に表示されることを確認

**Production URL**: ________________________________________________

**備考**: ________________________________________________

---

## Phase 3: 動作確認チェックリスト ✅

### 3.1 基本機能確認

- [ ] **3.1.1** ログインページが表示される
- [ ] **3.1.2** デフォルトアカウントでログインできる
  - Email: `admin@example.com`
  - Password: `password123`
- [ ] **3.1.3** ダッシュボードが表示される
- [ ] **3.1.4** サイドバーメニューが正しく表示される
- [ ] **3.1.5** ログアウトできる

**備考**: ________________________________________________

---

### 3.2 データベース接続確認

- [ ] **3.2.1** 組織一覧が表示される
- [ ] **3.2.2** 店舗一覧が表示される
- [ ] **3.2.3** 回収予定一覧が表示される
- [ ] **3.2.4** 新規データを登録できる
- [ ] **3.2.5** データを編集できる
- [ ] **3.2.6** データを削除できる

**備考**: ________________________________________________

---

### 3.3 API エンドポイント確認

#### Organizations API
- [ ] **3.3.1** GET `/api/organizations` が動作する
- [ ] **3.3.2** POST `/api/organizations` が動作する
- [ ] **3.3.3** GET `/api/organizations/[id]` が動作する
- [ ] **3.3.4** PATCH `/api/organizations/[id]` が動作する

#### Stores API
- [ ] **3.3.5** GET `/api/stores` が動作する
- [ ] **3.3.6** POST `/api/stores` が動作する

#### Plans API
- [ ] **3.3.7** GET `/api/plans` が動作する

**備考**: ________________________________________________

---

### 3.4 JWNET 連携確認

⚠️ **注意**: 本番JWNETキーが必要です。テストキーの場合はスキップ可。

- [ ] **3.4.1** JWNET 連携ページが表示される
- [ ] **3.4.2** マニフェスト登録フォームが表示される
- [ ] **3.4.3** 事業者組み合わせが選択できる
- [ ] **3.4.4** 廃棄物種別が選択できる

**備考**: ________________________________________________

---

### 3.5 請求管理確認

- [ ] **3.5.1** 請求管理ページが表示される
- [ ] **3.5.2** 請求データ生成ボタンが動作する
- [ ] **3.5.3** 請求サマリーが表示される
- [ ] **3.5.4** Excel出力ボタンが動作する
- [ ] **3.5.5** Excelファイルがダウンロードされる
- [ ] **3.5.6** Excelファイルの内容が正しい（列D～Rの配置確認）

**備考**: ________________________________________________

---

### 3.6 データ可視化確認

- [ ] **3.6.1** ダッシュボードのKPIカードが表示される
- [ ] **3.6.2** 月次請求トレンドグラフが表示される
- [ ] **3.6.3** 回収統計グラフが表示される
- [ ] **3.6.4** 廃棄物種別内訳グラフが表示される
- [ ] **3.6.5** 店舗別比較グラフが表示される

**備考**: ________________________________________________

---

## Phase 4: セキュリティ設定 ✅

### 4.1 Supabase セキュリティ

- [ ] **4.1.1** RLS (Row Level Security) が有効化されている
  ```sql
  SELECT tablename, rowsecurity 
  FROM pg_tables 
  WHERE schemaname = 'app';
  ```
- [ ] **4.1.2** すべてのテーブルで `rowsecurity = true` を確認
- [ ] **4.1.3** RLS ポリシーが正しく動作している（他ユーザーのデータが見えない）

**備考**: ________________________________________________

---

### 4.2 環境変数セキュリティ

- [ ] **4.2.1** 環境変数が Vercel に安全に保存されている
- [ ] **4.2.2** `.env.local` がリポジトリにコミットされていない
- [ ] **4.2.3** API キーがコードにハードコードされていない
- [ ] **4.2.4** データベースパスワードが適切な強度（12文字以上、記号含む）

**備考**: ________________________________________________

---

### 4.3 Vercel セキュリティ設定

- [ ] **4.3.1** カスタムドメイン設定（オプション）
- [ ] **4.3.2** HTTPS が有効化されている（Vercel デフォルト）
- [ ] **4.3.3** Environment Protection 設定（Production環境の保護）
- [ ] **4.3.4** Deployment Protection 設定（承認フロー）

**備考**: ________________________________________________

---

## Phase 5: モニタリング設定 ✅

### 5.1 Vercel Analytics

- [ ] **5.1.1** Vercel プロジェクト → Analytics に移動
- [ ] **5.1.2** Analytics が有効化されている
- [ ] **5.1.3** リアルタイムデータが表示される

**備考**: ________________________________________________

---

### 5.2 Supabase Monitoring

- [ ] **5.2.1** Supabase → Reports → Database に移動
- [ ] **5.2.2** Database Size を確認
- [ ] **5.2.3** Active Connections を確認
- [ ] **5.2.4** API Requests を確認
- [ ] **5.2.5** Storage Usage を確認

**備考**: ________________________________________________

---

### 5.3 エラー監視（オプション）

- [ ] **5.3.1** Sentry アカウント作成（オプション）
- [ ] **5.3.2** Sentry プロジェクト作成
- [ ] **5.3.3** Sentry DSN を Vercel 環境変数に追加
- [ ] **5.3.4** エラーログが Sentry に送信されることを確認

**備考**: ________________________________________________

---

## Phase 6: バックアップ設定 ✅

### 6.1 Supabase 自動バックアップ

- [ ] **6.1.1** Settings → Backups に移動
- [ ] **6.1.2** 自動バックアップが有効化されている
- [ ] **6.1.3** バックアップスケジュールを確認
  - Free tier: 日次、7日間保持
  - Pro tier: 日次、30日間保持
- [ ] **6.1.4** 最初のバックアップが完了している

**備考**: ________________________________________________

---

### 6.2 手動バックアップテスト

- [ ] **6.2.1** 手動バックアップを実行
  ```bash
  pg_dump $DATABASE_URL > backup_test_$(date +%Y%m%d).sql
  ```
- [ ] **6.2.2** バックアップファイルが生成された
- [ ] **6.2.3** バックアップファイルのサイズが妥当（> 1KB）
- [ ] **6.2.4** バックアップファイルを安全な場所に保管

**備考**: ________________________________________________

---

## Phase 7: UAT (User Acceptance Testing) ✅

### 7.1 UAT チェックリスト実施

- [ ] **7.1.1** `docs/UAT_CHECKLIST.md` を開く
- [ ] **7.1.2** Phase 1: 認証・認可（7項目）を実施
- [ ] **7.1.3** Phase 2: ダッシュボード（7項目）を実施
- [ ] **7.1.4** Phase 3: 組織・店舗管理（9項目）を実施
- [ ] **7.1.5** Phase 4: 収集予定・実績管理（11項目）を実施
- [ ] **7.1.6** Phase 5: 請求管理（7項目）を実施
- [ ] **7.1.7** Phase 6: 廃棄物マスター管理（5項目）を実施
- [ ] **7.1.8** Phase 7: JWNET 連携（9項目）を実施
- [ ] **7.1.9** Phase 8: パフォーマンス（4項目）を実施
- [ ] **7.1.10** Phase 9: レスポンシブデザイン（3項目）を実施
- [ ] **7.1.11** Phase 10: ブラウザ互換性（4項目）を実施
- [ ] **7.1.12** Phase 11: セキュリティ（4項目）を実施

**合計**: 70項目中 ______ 項目合格  
**不具合数**: ______  

**備考**: ________________________________________________

---

### 7.2 不具合対応

- [ ] **7.2.1** 検出された不具合をリスト化
- [ ] **7.2.2** 重要度を判定（Critical / Major / Minor）
- [ ] **7.2.3** Critical / Major 不具合を修正
- [ ] **7.2.4** 修正内容を main ブランチにマージ
- [ ] **7.2.5** Vercel で自動再デプロイ
- [ ] **7.2.6** 修正箇所を再テスト

**備考**: ________________________________________________

---

## Phase 8: パフォーマンステスト ✅

### 8.1 ページ読み込み速度

- [ ] **8.1.1** ログインページ: < 3秒
- [ ] **8.1.2** ダッシュボード: < 3秒
- [ ] **8.1.3** 組織一覧ページ: < 3秒
- [ ] **8.1.4** 店舗一覧ページ: < 3秒
- [ ] **8.1.5** 請求管理ページ: < 3秒

**備考**: ________________________________________________

---

### 8.2 API 応答速度

- [ ] **8.2.1** GET `/api/organizations`: < 1秒
- [ ] **8.2.2** GET `/api/stores`: < 1秒
- [ ] **8.2.3** GET `/api/plans`: < 1秒
- [ ] **8.2.4** POST `/api/collections`: < 2秒
- [ ] **8.2.5** GET `/api/billing-summaries/export-excel`: < 5秒

**備考**: ________________________________________________

---

## Phase 9: 本番リリース承認 ✅

### 9.1 ステークホルダー承認

- [ ] **9.1.1** プロジェクトマネージャー承認
- [ ] **9.1.2** 技術責任者承認
- [ ] **9.1.3** 業務部門承認
- [ ] **9.1.4** セキュリティ責任者承認

**署名**: ________________________________________________  
**日付**: ________________________________________________

---

### 9.2 リリースノート作成

- [ ] **9.2.1** リリースバージョン番号を決定（例: v1.0.0）
- [ ] **9.2.2** リリースノートを作成
  - 主要機能
  - バグ修正
  - 既知の制限事項
  - 今後の予定
- [ ] **9.2.3** リリースノートをステークホルダーに共有

**備考**: ________________________________________________

---

### 9.3 リリース日時の決定

- [ ] **9.3.1** リリース予定日を決定
- [ ] **9.3.2** リリース時刻を決定（推奨: 平日 14:00-16:00）
- [ ] **9.3.3** 関係者に通知

**リリース予定**: _________________ _____:_____ JST

**備考**: ________________________________________________

---

## Phase 10: 本番リリース実施 🚀

### 10.1 リリース当日作業

- [ ] **10.1.1** システム稼働状態を最終確認
- [ ] **10.1.2** データベースバックアップを手動実行
- [ ] **10.1.3** Vercel で本番環境に最終デプロイ
- [ ] **10.1.4** デプロイ完了を確認
- [ ] **10.1.5** 本番URLにアクセスして動作確認

**備考**: ________________________________________________

---

### 10.2 リリース直後確認（15分以内）

- [ ] **10.2.1** ログイン機能の確認
- [ ] **10.2.2** ダッシュボード表示の確認
- [ ] **10.2.3** データベース接続の確認
- [ ] **10.2.4** 主要API動作の確認
- [ ] **10.2.5** エラーログの確認（Vercel / Supabase）

**備考**: ________________________________________________

---

### 10.3 リリース後監視（24時間）

- [ ] **10.3.1** 1時間後: システム稼働確認
- [ ] **10.3.2** 3時間後: パフォーマンス確認
- [ ] **10.3.3** 6時間後: エラーレート確認
- [ ] **10.3.4** 12時間後: ユーザーフィードバック確認
- [ ] **10.3.5** 24時間後: 総合評価

**備考**: ________________________________________________

---

## Phase 11: リリース後フォロー ✅

### 11.1 ユーザーサポート

- [ ] **11.1.1** ユーザーマニュアルを配布
- [ ] **11.1.2** トレーニング実施（必要に応じて）
- [ ] **11.1.3** サポート窓口の案内
- [ ] **11.1.4** FAQ の更新

**備考**: ________________________________________________

---

### 11.2 改善点の収集

- [ ] **11.2.1** ユーザーフィードバックを収集
- [ ] **11.2.2** 改善要望をリスト化
- [ ] **11.2.3** 優先順位を決定
- [ ] **11.2.4** 次期バージョンの計画

**備考**: ________________________________________________

---

## 🎉 本番リリース完了！

**リリース完了日時**: _________________ _____:_____  
**リリース担当者**: _________________  
**最終確認者**: _________________

---

## 📞 緊急連絡先

| 役割 | 担当者 | 連絡先 |
|-----|--------|--------|
| プロジェクトマネージャー | __________ | __________ |
| 技術責任者 | __________ | __________ |
| システム管理者 | __________ | __________ |
| セキュリティ責任者 | __________ | __________ |

---

## 📚 参考ドキュメント

- [本番環境デプロイメントガイド](./PRODUCTION_DEPLOYMENT_GUIDE.md)
- [UAT チェックリスト](./UAT_CHECKLIST.md)
- [ユーザーマニュアル](./USER_MANUAL.md)
- [運用手順書](./OPERATION_MANUAL.md)
- [README](../next-app/README.md)

---

**© 2025 BABA Waste System. All rights reserved.**

